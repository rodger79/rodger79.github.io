<html>
<head>
<script type="text/javascript">

function buttonpress(x) {
  //logic on the gui
  console.log(calculatorform.input1.value);
  if (x == "clear") {
    //clear the input form
    calculatorform.input1.value = "";
  } 
  else if(x == "del"){
    //delete single char off input form
    calculatorform.input1.value =  (calculatorform.input1.value).slice(0,-1);   
  }
  else if (calculatorform.input1.value == "0" || calculatorform.input1.value == "Infinity"){
    //special cases, if zero or infinity in input form, don't append
    calculatorform.input1.value = x;
  }
  else {
    //all other cases, append new char to input
    calculatorform.input1.value =  calculatorform.input1.value + x;   
  }
}

function evaluate1(x) {
  // calculatorform.input1.value = eval(x); //calls built in evaluator 
  //parse the input string
  var tree = parse(x);
  //recursively parse object tree to do calculation
  calculatorform.input1.value = calculate(tree);
}

//return object tree of tokenized code
function lexer(inputstring) {
    var retval = [];
    var regexp = /\s*([0-9]+|\S)\s*/g;
    var n;
    while ((n = regexp.exec(inputstring)) !== null)
        retval.push(n[1]);
    return retval;
}

function isNumber(token) {
    return ((token !== undefined) && (token.match(/^[0-9]+$/) !== null));
}


function parse(code) {
  var tokens = lexer(code);
  var position = 0;
  function peek() {
    return tokens[position];
  }
  function increment(token) {
    position++;
  }
  function parsePrimaryExpr() {
    var t = peek();
    if (isNumber(t)) {
        increment(t);
        return {type: "number", value: t};
    } 
    else if (t === "(") {
      increment(t);
      var expr = parseExpr();
      if (peek() !== ")")
        increment(")");
        return expr;
      }
    }
    function parseMulExpr() {
      var expr = parsePrimaryExpr();
      var t = peek();
      while (t == "*" || t == "/") {
        increment(t);
        var rhs = parsePrimaryExpr();
        expr = {type: t, left: expr, right: rhs};
        t = peek();
      }
      return expr;
    }
    function parseExpr() {
      var expr = parseMulExpr();
      var t = peek();
      while (t == "+" || t == "-") {
        increment(t);
        var rhs = parseMulExpr();
        expr = {type: t, left: expr, right: rhs};
        t = peek();
      }
      return expr;
    }
    var result = parseExpr();

    return result;
}

//neeed recursive function to do math on object tree of analyzed
function calculate(tree) {
  //if type is number return value
  if (tree.type == 'number') {
    return tree.value;
  } 
  //recursive calls on lower branches if first operation is mathematical
  else 
    switch (tree.type){
      case ("+"):
        return parseInt(calculate(tree.left)) + parseInt(calculate(tree.right));
        break;
      case ("-"):
        return parseInt(calculate(tree.left)) - parseInt(calculate(tree.right));
        break;
      case ("*"):
        return parseInt(calculate(tree.left)) * parseInt(calculate(tree.right));
        break;
      case ("/"):
        return parseInt(calculate(tree.left)) / parseInt(calculate(tree.right));
        break;
    }
}


</script>
<body>
<form name=calculatorform>
	<input type=text name=input1 style="text-align:right;height:40px;width:310px;margin-right:10px;">
	</br>
	<input type=button name=button7 value=7 onclick="buttonpress(button7.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=button8 value=8 onclick="buttonpress(button8.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=button9 value=9 onclick="buttonpress(button9.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=add value=+ onclick="buttonpress(add.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=clr value=CLR onclick="buttonpress('clear')" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=del value=DEL onclick="buttonpress('del')" style="height:40px;width:40px;margin-right:10px;">
	</br>
	<input type=button name=button4 value=4 onclick="buttonpress(button4.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=button5 value=5 onclick="buttonpress(button5.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=button6 value=6 onclick="buttonpress(button6.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=subtract value=- onclick="buttonpress(subtract.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=lparen value=( onclick="buttonpress(lparen.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=rparen value=) onclick="buttonpress(rparen.value)" style="height:40px;width:40px;margin-right:10px;">
	</br>
	<input type=button name=button1 value=1 onclick="buttonpress(button1.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=button2 value=2 onclick="buttonpress(button2.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=button3 value=3 onclick="buttonpress(button3.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=multiply value=* onclick="buttonpress(multiply.value)" style="height:40px;width:40px;margin-right:10px;">
    </br>
	<input type=button name=button0 value=0 onclick="buttonpress(button0.value)" style="height:40px;width:40px;margin-right:10px;margin-left:54px;">
	<input type=button name=buttoneq value== onclick="evaluate1(input1.value)" style="height:40px;width:40px;margin-right:10px;">
	<input type=button name=divide value=/ onclick="buttonpress(divide.value)" style="height:40px;width:40px;margin-right:10px;">
	</br>
</form>
</body>
</head>
</html>
